# 第九章：for循环的深入使用

## 9.1 嵌套循环：循环中的循环

### 9.1.1 什么是嵌套循环？

嵌套循环就是"循环套循环"——在一个循环的内部再放置另一个循环。就像时钟的时针和分针：时针每走一大格（外层循环），分针就要走完整整60小格（内层循环）。

### 9.1.2 嵌套循环的基本结构

```cpp
for (外层初始化; 外层条件; 外层更新) {
    for (内层初始化; 内层条件; 内层更新) {
        // 需要重复执行的代码
    }
}
```

**执行顺序**：外层循环每执行一次，内层循环就要完整地执行一遍。

### 9.1.3 实战案例：打印乘法口诀表

还记得第八章练习中的乘法口诀表吗？现在我们就用嵌套循环来实现它：

```cpp
#include <iostream>
#include <iomanip>  // 用于格式化输出
using namespace std;

int main() {
    cout << "========== 乘法口诀表 ==========" << endl;
    
    for (int i = 1; i <= 9; i++) {          // 外层循环控制行（乘数）
        for (int j = 1; j <= i; j++) {      // 内层循环控制列（被乘数）
            // 使用setw(2)设置输出宽度为2，保证对齐
            cout << j << "×" << i << "=" << setw(2) << i * j << "  ";
        }
        cout << endl;  // 每打印完一行后换行
    }
    
    return 0;
}
```

**执行过程解析**：
1. i=1（第1行），j从1到1：打印"1×1=1"
2. i=2（第2行），j从1到2：打印"1×2=2 2×2=4"
3. i=3（第3行），j从1到3：打印"1×3=3 2×3=6 3×3=9"
4. ...直到i=9

### 9.1.4 经典应用：打印图形图案

#### 案例1：打印直角三角形

```cpp
#include <iostream>
using namespace std;

int main() {
    int n;
    cout << "请输入三角形的高度：";
    cin >> n;
    
    for (int i = 1; i <= n; i++) {          // 控制行数
        for (int j = 1; j <= i; j++) {      // 控制每行星号数
            cout << "* ";
        }
        cout << endl;
    }
    
    return 0;
}
```

输入5时输出：
```
* 
* * 
* * * 
* * * * 
* * * * * 
```

#### 案例2：打印倒三角形

```cpp
#include <iostream>
using namespace std;

int main() {
    int n;
    cout << "请输入倒三角形的高度：";
    cin >> n;
    
    for (int i = n; i >= 1; i--) {          // 行数从n递减到1
        for (int j = 1; j <= i; j++) {      // 星号数等于当前行数
            cout << "* ";
        }
        cout << endl;
    }
    
    return 0;
}
```

输入5时输出：
```
* * * * * 
* * * * 
* * * 
* * 
* 
```

#### 案例3：打印金字塔

```cpp
#include <iostream>
using namespace std;

int main() {
    int n;
    cout << "请输入金字塔的层数：";
    cin >> n;
    
    for (int i = 1; i <= n; i++) {
        // 打印空格（金字塔左侧空白）
        for (int j = 1; j <= n - i; j++) {
            cout << "  ";
        }
        // 打印星号（金字塔本体）
        for (int k = 1; k <= 2 * i - 1; k++) {
            cout << "* ";
        }
        cout << endl;
    }
    
    return 0;
}
```

输入4时输出：
```
      * 
    * * * 
  * * * * * 
* * * * * * * 
```

## 9.2 循环控制语句：break和continue

### 9.2.1 break语句：提前结束循环

`break`用于完全终止当前循环，跳出循环体，继续执行循环后面的代码。

#### 案例：查找特定数字

```cpp
#include <iostream>
using namespace std;

int main() {
    int target, number;
    
    cout << "请输入要查找的数字（1-100）：";
    cin >> target;
    
    cout << "开始查找..." << endl;
    for (int i = 1; i <= 100; i++) {
        cout << "正在检查数字：" << i << endl;
        
        if (i == target) {
            cout << "找到了！目标数字是：" << i << endl;
            break;  // 找到后立即退出循环
        }
    }
    
    cout << "查找结束" << endl;
    return 0;
}
```

**重要特性**：在嵌套循环中，`break`只跳出**当前所在的那一层循环**。

```cpp
// break在嵌套循环中的表现
for (int i = 1; i <= 3; i++) {
    cout << "外层循环第" << i << "次" << endl;
    
    for (int j = 1; j <= 5; j++) {
        if (j == 3) {
            cout << "内层循环遇到3，break！" << endl;
            break;  // 只跳出内层循环
        }
        cout << "  内层循环第" << j << "次" << endl;
    }
}
```

输出：
```
外层循环第1次
  内层循环第1次
  内层循环第2次
内层循环遇到3，break！
外层循环第2次
  内层循环第1次
  内层循环第2次
内层循环遇到3，break！
外层循环第3次
  内层循环第1次
  内层循环第2次
内层循环遇到3，break！
```

### 9.2.2 continue语句：跳过本次循环

`continue`用于跳过当前循环的剩余代码，直接开始下一次循环。

#### 案例：打印1-20中不是3的倍数的数字

```cpp
#include <iostream>
using namespace std;

int main() {
    cout << "1-20中不是3的倍数的数字有：" << endl;
    
    for (int i = 1; i <= 20; i++) {
        if (i % 3 == 0) {  // 如果是3的倍数
            continue;      // 跳过本次循环，不打印这个数字
        }
        cout << i << " ";
    }
    
    cout << endl;
    return 0;
}
```

输出：`1 2 4 5 7 8 10 11 13 14 16 17 19 20`

#### 对比break和continue

| 语句       | 作用                   | 循环状态       | 类比                     |
| ---------- | ---------------------- | -------------- | ------------------------ |
| `break`    | 立即终止整个循环       | 循环结束       | 电视剧看到一半直接关电视 |
| `continue` | 跳过当前循环的剩余部分 | 继续下一次循环 | 跳过电视剧的这一集广告   |

```cpp
// break和continue对比演示
cout << "break演示：" << endl;
for (int i = 1; i <= 5; i++) {
    if (i == 3) break;
    cout << i << " ";
}
cout << endl;

cout << "continue演示：" << endl;
for (int i = 1; i <= 5; i++) {
    if (i == 3) continue;
    cout << i << " ";
}
cout << endl;
```

输出：
```
break演示：1 2 
continue演示：1 2 4 5
```

## 9.3 循环的灵活控制

### 9.3.1 循环变量的多重更新

```cpp
// 同时更新两个循环变量
for (int i = 1, j = 10; i <= 5; i++, j--) {
    cout << "i=" << i << ", j=" << j << endl;
}
```

### 9.3.2 循环控制条件的灵活设置

```cpp
// 使用复合条件控制循环
int count = 0;
for (int i = 1; i <= 100 && count < 10; i++) {
    if (i % 7 == 0) {  // 找出前10个7的倍数
        cout << i << " ";
        count++;
    }
}
```

### 9.3.3 无限循环与退出条件

```cpp
// 无限循环配合break退出
int sum = 0;
for (;;) {  // 没有条件表达式，理论上无限循环
    int num;
    cout << "请输入一个数字（输入0结束）：";
    cin >> num;
    
    if (num == 0) {
        break;  // 用户输入0时退出循环
    }
    
    sum += num;
    cout << "当前累计和：" << sum << endl;
}
```

## 9.4 综合实战项目

### 项目1：简易计算器（支持连续计算）

```cpp
#include <iostream>
using namespace std;

int main() {
    char op;
    double num1, num2, result;
    
    cout << "=== 简易计算器 ===" << endl;
    cout << "支持：+ - * /，输入q退出" << endl;
    
    for (;;) {
        cout << "\n请输入算式（如：3 + 5）：";
        
        // 先判断是否要退出
        if (!(cin >> num1 >> op)) {
            break;
        }
        
        if (op == 'q' || op == 'Q') {
            break;
        }
        
        cin >> num2;
        
        // 执行计算
        switch (op) {
            case '+':
                result = num1 + num2;
                break;
            case '-':
                result = num1 - num2;
                break;
            case '*':
                result = num1 * num2;
                break;
            case '/':
                if (num2 == 0) {
                    cout << "错误：除数不能为0！" << endl;
                    continue;  // 跳过本次循环，重新输入
                }
                result = num1 / num2;
                break;
            default:
                cout << "错误：不支持的操作符！" << endl;
                continue;  // 跳过本次循环，重新输入
        }
        
        cout << "结果：" << num1 << " " << op << " " << num2 << " = " << result << endl;
    }
    
    cout << "计算器已退出，感谢使用！" << endl;
    return 0;
}
```

### 项目2：猜数字游戏

```cpp
#include <iostream>
#include <cstdlib>  // 用于rand()函数
#include <ctime>    // 用于time()函数
using namespace std;

int main() {
    srand(time(0));  // 设置随机数种子
    int secret = rand() % 100 + 1;  // 生成1-100的随机数
    int guess, attempts = 0;
    
    cout << "=== 猜数字游戏 ===" << endl;
    cout << "我已经想好了一个1-100之间的数字，来猜猜看吧！" << endl;
    
    for (attempts = 1; attempts <= 10; attempts++) {
        cout << "\n第" << attempts << "次尝试，请输入你的猜测：";
        cin >> guess;
        
        if (guess == secret) {
            cout << "恭喜你！猜对了！" << endl;
            break;  // 猜对后退出循环
        } else if (guess < secret) {
            cout << "太小了，再大一点！" << endl;
        } else {
            cout << "太大了，再小一点！" << endl;
        }
        
        // 提示剩余次数
        if (attempts < 10) {
            cout << "你还有" << (10 - attempts) << "次机会" << endl;
        }
    }
    
    if (attempts > 10) {
        cout << "\n很遗憾，10次机会用完了！" << endl;
        cout << "正确答案是：" << secret << endl;
    } else {
        cout << "你用了" << attempts << "次就猜对了，真棒！" << endl;
    }
    
    return 0;
}
```



## 9.5 常见错误与调试技巧

### 错误1：嵌套循环变量混淆

```cpp
// 错误：内外层循环变量用了相同的名字
for (int i = 1; i <= 5; i++) {
    for (int i = 1; i <= 5; i++) {  // 错误！应该用不同的变量名
        cout << "*";
    }
    cout << endl;
}

// 正确：使用不同的变量名
for (int i = 1; i <= 5; i++) {
    for (int j = 1; j <= 5; j++) {  // 正确！
        cout << "*";
    }
    cout << endl;
}
```

### 错误2：break/continue位置不当

```cpp
// 错误：break放错了位置
for (int i = 1; i <= 5; i++) {
    cout << i << " ";
    break;  // 这会导致循环只执行一次
    cout << "这行代码永远不会执行";
}
```

### 调试技巧：打印循环状态

```cpp
for (int i = 1; i <= 5; i++) {
    cout << "[外层循环] i=" << i << endl;
    
    for (int j = 1; j <= 3; j++) {
        cout << "  [内层循环] j=" << j;
        
        if (i == 3 && j == 2) {
            cout << " (触发特殊条件)" << endl;
            continue;
        }
        
        cout << " 计算结果：" << i * j << endl;
    }
}
```

## 9.6 小试牛刀：挑战练习

### 练习1：打印空心正方形

编写程序，根据用户输入的边长n，打印一个边长为n的空心正方形。

示例（n=5）：
```
* * * * *
*       *
*       *
*       *
* * * * *
```

### 练习2：寻找水仙花数

水仙花数是指一个3位数，其各位数字的立方和等于该数本身（如153=1³+5³+3³）。

编写程序，找出所有3位水仙花数。

### 练习3：质数判断器

编写程序，让用户输入一个正整数，判断它是否为质数（只能被1和自身整除的数）。

**进阶**：使用循环优化，只需检查到√n即可。

### 练习4：数字金字塔

编写程序，打印如下数字金字塔：
```
    1
   121
  12321
 1234321
123454321
```

## 9.7 本章小结

本章我们深入学习了for循环的高级用法，掌握了：
1. **嵌套循环**：处理多维数据，打印复杂图案
2. **循环控制语句**：`break`终止循环，`continue`跳过本次循环
3. **灵活循环控制**：多重更新、复合条件、无限循环
4. **循环优化技巧**：减少内部计算、循环展开

通过猜数字游戏和计算器等实战项目，我们将理论知识应用到了实际场景中。for循环就像编程中的"重复机器"，掌握了它，你就能让程序自动完成大量重复性工作。

**关键技能清单**：
- [ ] 能使用嵌套循环打印各种图案
- [ ] 理解break和continue的区别与用法
- [ ] 能编写包含循环的完整程序（如游戏、工具）
- [ ] 能调试循环相关的错误

在下一章，我们将学习另一种循环结构——**while循环**，它更适合处理"不知道具体循环次数"的场景。届时，你会拥有更强大的循环工具包！
