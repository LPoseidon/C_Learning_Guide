# 第八章：认识for循环

## 8.1 为什么需要for循环？

在前几章的学习中，我们编写的程序执行流程要么是“直线式”（自上而下依次执行），要么是“分支式”（根据条件选择执行路径）。但现实中很多任务需要重复执行多次：比如打印10份“欢迎光临”的标语、计算1到100的累加和、统计50名学生的平均分、打印一个5行5列的星号正方形。

如果没有循环，我们只能通过复制粘贴代码来实现重复操作。例如，打印1到5的数字需要写5条cout语句：

```cpp
cout << 1 << endl;
cout << 2 << endl;
cout << 3 << endl;
cout << 4 << endl;
cout << 5 << endl;
```

这样不仅代码冗余、效率低下，还容易出错（比如漏改数字）。而for循环能让程序“自动化重复执行一段代码块”，只需编写一次循环结构，就能控制代码重复执行的次数和逻辑，极大提升编程效率。

## 8.2 for循环的语法结构：三要素控制重复

for循环是C++中最常用的循环语句之一，它通过“初始化、条件判断、更新”三个核心表达式，精确控制循环的开始、持续和结束。语法格式严格固定：

```cpp
for (初始化表达式; 条件表达式; 更新表达式) {
    // 循环体：需要重复执行的代码块
}
```

三个表达式的作用：

- **初始化表达式**：循环开始前执行一次，通常用于定义和初始化循环变量（如int i = 1）。
- **条件表达式**：每次执行循环体前都会判断。若结果为true，则执行循环体；若为false，则跳出循环，执行循环之后的代码。
- **更新表达式**：每次执行完循环体后执行，通常用于修改循环变量的值（如i++，让变量自增1），控制循环走向结束。

## 8.3 for循环的执行流程：step by step

for循环的执行顺序是理解其核心的关键，我们以“打印1到5的数字”为例，拆解每一步流程。首先写出完整示例代码：

```cpp
for (int i = 1; i <= 5; i++) {
    cout << i << endl;
}
```

执行流程分步解析：

1. **第一步：执行初始化表达式（仅一次）**：执行`int i = 1`，定义循环变量i并赋值为1。此时循环变量i的初始状态为1，这是循环的起点。
2. **第二步：执行条件表达式判断**：判断`i <= 5`是否成立。当前i=1，1<=5结果为true，因此进入循环体执行。
3. **第三步：执行循环体**：执行`cout << i << endl;`，在控制台打印出当前i的值“1”并换行。
4. **第四步：执行更新表达式**：执行`i++`，将循环变量i的值自增1，此时i由1变为2。
5. **第五步：重复条件判断与循环流程**：再次回到第二步判断条件表达式`i <= 5`，当前i=2，结果仍为true，继续执行循环体打印“2”，之后i++变为3；重复此过程，直到i的值变为5时：
6. 条件判断`i=5 <=5`为true，执行循环体打印“5”；
7. 执行更新表达式i++，i变为6。
8. **第六步：条件不成立，跳出循环**：再次回到第二步判断条件表达式`i=6 <=5`，结果为false，循环终止。程序将继续执行for循环之后的代码（若有）。

总结：for循环的执行逻辑可概括为“**初始化一次 → 条件判断→循环体→更新变量**”的循环，直到条件判断为false时退出，整个过程中条件判断是循环是否继续的“开关”。

## 8.4 for循环的常见应用场景

for循环的灵活性使其在多种重复任务中广泛应用，以下是几个典型场景：

- **累加/累乘计算**：通过循环变量依次获取数值，进行累加或累乘操作。例如计算1到100的累加和、5的阶乘（5! = 1×2×3×4×5）。
- **遍历输出**：按顺序输出一系列数据，如打印1到10的所有奇数、输出数组中的每个元素。
- **图案打印**：通过嵌套for循环（循环内部包含另一个循环）打印规则图案，如三角形、正方形、菱形等星号图案。
- **数据统计**：对一组数据进行统计分析，如统计班级50名学生成绩中及格的人数、计算平均分。

## 8.5 基础案例：打印数字与累加计算

### 案例1：打印10到1的倒序数字

```cpp
#include <iostream>
using namespace std;

int main() {
    for (int i = 10; i >= 1; i--) {
        cout << i << " ";
    }
    cout << endl;
    return 0;
}
```

运行结果：`10 9 8 7 6 5 4 3 2 1`

**解析**：初始化i=10，每次循环后i减1，直到i<1时停止。注意条件表达式是`i >= 1`，更新表达式是`i--`。

### 案例2：计算1到100的累加和

```cpp
#include <iostream>
using namespace std;

int main() {
    int sum = 0;  // 存放累加结果的变量
    
    for (int i = 1; i <= 100; i++) {
        sum = sum + i;  // 等价于 sum += i;
    }
    
    cout << "1到100的累加和是：" << sum << endl;
    return 0;
}
```

**执行过程模拟**：
- 第一次循环：sum=0+1=1
- 第二次循环：sum=1+2=3
- 第三次循环：sum=3+3=6
- ...
- 第一百次循环：sum=4950+100=5050

**小技巧**：累加时常用`sum += i;`简化写法，和`sum = sum + i;`完全等效。

## 8.6 进阶案例：条件控制与阶乘计算

### 案例3：打印1~20之间的所有偶数

```cpp
#include <iostream>
using namespace std;

int main() {
    for (int i = 1; i <= 20; i++) {
        if (i % 2 == 0) {  // 判断是否为偶数
            cout << i << " ";
        }
    }
    cout << endl;
    return 0;
}
```

运行结果：`2 4 6 8 10 12 14 16 18 20`

**解析**：`i % 2 == 0`是判断i是否为偶数的常用方法，因为偶数除以2的余数为0。

### 案例4：计算5的阶乘（5!）

阶乘公式：`n! = 1 × 2 × 3 × ... × n`

```cpp
#include <iostream>
using namespace std;

int main() {
    int factorial = 1;  // 阶乘结果，初始值为1（乘法起点）
    
    for (int i = 1; i <= 5; i++) {
        factorial *= i;  // 等价于 factorial = factorial * i;
    }
    
    cout << "5的阶乘是：" << factorial << endl;
    return 0;
}
```

**执行过程**：
- i=1: factorial=1×1=1
- i=2: factorial=1×2=2
- i=3: factorial=2×3=6
- i=4: factorial=6×4=24
- i=5: factorial=24×5=120

最终输出：`5的阶乘是：120`

## 8.7 for循环的灵活变体

### 变体1：循环变量步长不为1

```cpp
// 打印0到10之间所有3的倍数
for (int i = 0; i <= 10; i += 3) {
    cout << i << " ";
}
// 输出：0 3 6 9
```

### 变体2：省略部分表达式（需谨慎）

```cpp
int i = 1;
for (; i <= 5; ) {  // 省略初始化和更新表达式
    cout << i << " ";
    i++;  // 在循环体内更新变量
}
// 输出：1 2 3 4 5
```

**注意**：虽然可以省略，但分号`;`必须保留，且通常不建议初学者省略，以免逻辑混乱。

## 8.8 常见错误与调试技巧

### 错误1：死循环（无限循环）

```cpp
for (int i = 1; i <= 5; i--) {  // i--导致i越来越小，永远<=5
    cout << i << " ";
}
```

**现象**：程序不停输出，需要强制终止（按Ctrl+C）。
**修改**：将`i--`改为`i++`。

### 错误2：循环条件逻辑错误

```cpp
// 想打印1到5，结果只打印到4
for (int i = 1; i < 5; i++) {  // 应该是 i <= 5
    cout << i << " ";
}
// 输出：1 2 3 4
```

**调试技巧**：在循环内打印循环变量的值，观察变化：

```cpp
for (int i = 1; i <= 5; i++) {
    cout << "当前i=" << i << "，准备执行循环体" << endl;
    // 你的代码...
}
```

## 8.9 小试牛刀：for循环实战练习

### 练习1：计算1~100所有奇数的和

提示：奇数满足`i % 2 != 0` 或 `i % 2 == 1`

### 练习2：打印乘法口诀表（1~9）

要求输出格式：
```
1×1=1
1×2=2  2×2=4
1×3=3  2×3=6  3×3=9
...
```

**进阶提示**：这需要用到**嵌套for循环**（一个for循环内部包含另一个for循环），下一章我们会详细学习。

### 练习3：用户输入n，计算1²+2²+3²+...+n²的和

示例：
```
请输入n：4
1²+2²+3²+4²=30
```

## 8.10 本章小结

本章我们系统学习了for循环的语法、执行流程和应用场景。for循环通过“初始化、条件、更新”三要素，实现了代码的自动化重复执行，是处理重复任务的高效工具。我们通过打印数字、累加计算、阶乘等案例，掌握了for循环的基本用法；也了解了循环的灵活变体和常见错误调试方法。

for循环就像是一个“自动计数器”，你告诉它从哪里开始、到哪里结束、每次数多少，它就能帮你完成重复性的计数任务。下一章我们将学习更强大的**嵌套循环**，用它来打印图案、处理表格数据，让程序能处理更复杂的重复结构。

**关键点回顾**：
1. for循环语法：`for(初始化;条件;更新){循环体}`
2. 执行顺序：初始化→条件判断→循环体→更新→条件判断→...
3. 常用场景：遍历、累加、统计、图案打印
4. 调试技巧：在循环内打印变量值，观察执行过程
